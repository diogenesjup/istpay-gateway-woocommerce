"use strict";export default class RouterProvide{static create(...e){return RouterProvide.instance||(RouterProvide.instance=new this(...e)),RouterProvide.instance}constructor(e=!0){e&&(document.body.innerHTML+='<div id="view-router"></div>'),this.routes=new Map,this.params=[]}escapeRegExp(e){return"^"+e.replace(/\//gim,"\\/")+"$"}isRouteParam(e){const t=(e=>e.match(/\{(.*?)\}/gim))(e);if(t&&Array.isArray(t)){const r=e=>e.replace(/(\{|\})/gim,""),s=(e,t)=>e.replace(new RegExp(`(${t.join("|")})`,"gim"),"(.*?)");return{keys:t.map(e=>r(e).trim()),newRoute:s(e,t)}}return!1}toRoute(e){return"/#"+e}redirect(e){const t=this.toRoute(e);return window.location=t,t}any(e,...t){if(!1===this.routes.has(e)){const r=this.isRouteParam(e);if(!1===r||null===r)this.routes.set(new RegExp(this.escapeRegExp(e)),t.reverse());else if(r.hasOwnProperty("newRoute")){let e=new RegExp(this.escapeRegExp(r.newRoute));this.params.push({route:e,keys:r.keys}),this.routes.set(e,t.reverse())}}}async runMiddleware(e,t){let r=document.getElementById("view-router"),s=null;for(let i=0;i<e.length;i+=1)s=e[i].bind(null,t,r,s);s()}trate(e){const t=Array.from(this.routes.keys()).find((t,r)=>t.test(e));if(t){const r=this.routes.get(t),s=this.params.find(e=>e.route===t);if(s&&r){let[,...t]=e.match(s.route),i={};return s.keys.map((e,r)=>i[e]=t[r]),console.log(i),this.runMiddleware(r,i)}return this.runMiddleware(r,{})}}push_event(e){window.history.pushState({url:e},e,e);this.trate(e)}dispatch(){window.onpopstate=e=>{var t=""!==window.location.hash?window.location.hash.split("#").pop():window.location.pathname;this.push_event(t)};let e=""!==window.location.hash?window.location.hash.split("#").pop():window.location.pathname;this.push_event(e)}}
